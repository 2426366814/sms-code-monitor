# 管理员后台问题修复计划

## 问题分析
1. **退出功能问题**：代码已实现，但可能存在UI渲染问题导致用户无法找到退出按钮
2. **用户添加权限错误**：权限检查逻辑有误，使用了错误的权限名称
3. **API功能无效**：可能是数据库表不存在或初始化失败

## 修复方案

### 1. 修复用户添加权限错误
- **文件**：`backend/api/admin/index.php`
- **问题**：第55-57行使用`checkPermission($payload['id'], 'admin')`，其中'admin'是权限名称而非角色名称
- **修复**：将权限检查修改为直接检查admin角色，或使用正确的权限名称
- **代码变更**：
  ```php
  // 原代码
  if (!$userService->checkPermission($payload['id'], 'admin')) {
      ResponseUtil::error('无权限访问此资源', 403);
  }
  // 修改为
  if (!$userService->checkPermission($payload['id'], 'manage_users')) {
      ResponseUtil::error('无权限访问此资源', 403);
  }
  ```

### 2. 确保退出功能可访问
- **文件**：`frontend/admin/users.html` 和 `frontend/admin/system.html`
- **问题**：退出按钮可能因UI渲染问题不可见
- **修复**：确保Bootstrap下拉菜单功能正常，检查DOM结构和CSS
- **代码变更**：
  - 确保`data-bs-toggle="dropdown"`属性正确设置
  - 确保Bootstrap JS文件正确加载

### 3. 修复API功能
- **文件**：`backend/api/api_keys/index.php` 和 `backend/utils/DatabaseInit.php`
- **问题**：`api_keys`表可能不存在或初始化失败
- **修复**：确保数据库初始化逻辑正确，特别是`api_keys`表的创建
- **代码变更**：
  - 检查`DatabaseInit::checkAndInit()`方法，确保它正确创建`api_keys`表
  - 确保API请求路径正确

## 修复步骤
1. 首先修复权限检查逻辑，解决用户添加失败问题
2. 然后检查并修复退出功能的UI问题
3. 最后确保API功能正常工作，包括数据库表初始化

## 预期结果
- 管理员可以成功添加用户
- 退出按钮可见且功能正常
- API密钥生成功能正常，API端点可访问