# 代码和功能完整性修复计划

## 问题分析

通过对代码和开发文档的全面检查，发现以下主要问题：

1. **API密钥服务字段不匹配**
   - `ApiKeyService` 类期望 `api_key_id` 和 `api_secret` 字段
   - `DatabaseInit.php` 中定义的 `api_keys` 表只有 `api_key` 和 `api_secret` 字段
   - `ApiKeyModel` 中缺少 `getByApiKeyId` 方法

2. **监控服务表结构不一致**
   - `MonitorService` 使用 `phone`、`url` 等字段
   - `DatabaseInit.php` 中定义的 `monitors` 表使用 `phone_number`、`service_name` 等不同字段

3. **数据库表创建逻辑重复**
   - 多个模型文件中都有表创建逻辑
   - 不同文件中定义的表结构不一致

## 修复计划

### 1. 统一数据库表结构

- **修改 `DatabaseInit.php`**
  - 更新 `api_keys` 表结构，添加 `api_key_id` 字段，移除 `api_key` 字段
  - 更新 `monitors` 表结构，使用 `phone`、`url` 字段替代 `phone_number`、`service_name`
  - 确保所有表结构与模型期望一致

### 2. 修复 API 密钥服务

- **修改 `ApiKeyModel.php`**
  - 添加 `getByApiKeyId` 方法
  - 更新 `ensureTableExists` 方法，确保表结构与 `DatabaseInit.php` 一致
  - 更新 `generateApiKey` 方法，使用正确的字段名

- **修改 `ApiKeyService.php`**
  - 确保与 `ApiKeyModel` 的方法调用一致

### 3. 修复监控服务

- **修改 `MonitorService.php`**
  - 确保与 `MonitorModel` 的表结构一致

### 4. 移除重复的表创建逻辑

- 保留 `DatabaseInit.php` 中的统一表创建逻辑
- 移除模型文件中的重复表创建代码
- 确保所有模型依赖 `DatabaseInit.php` 来创建表

### 5. 测试验证

- 运行健康检测，确保所有功能正常
- 测试API密钥生成和验证功能
- 测试监控项添加和刷新功能
- 验证数据库表结构一致性

## 预期结果

- 所有数据库表结构统一一致
- API密钥服务正常工作
- 监控服务正常工作
- 代码结构清晰，没有重复逻辑
- 所有功能符合开发文档要求