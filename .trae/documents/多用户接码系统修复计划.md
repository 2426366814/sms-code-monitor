# 多用户接码系统修复计划

## 问题分析

1. **数据库连接问题**：BaseModel.php的构造函数中检查配置项时，使用了错误的键名
2. **前端请求路径问题**：前端登录页面使用绝对路径访问API，可能导致本地测试无法正确访问
3. **后端路由问题**：直接访问API文件可能跳过路由处理
4. **数据库初始化问题**：DatabaseInit.php可能没有正确处理所有表的创建
5. **API密钥生成问题**：api_keys表可能不存在
6. **登录问题**：管理员和用户登录可能失败
7. **文件路径问题**：相对路径引用错误
8. **依赖加载问题**：直接加载vendor/autoload.php可能导致依赖加载失败

## 修复步骤

1. **修复BaseModel.php中的数据库配置检查**
   - 修改构造函数中的配置项检查，确保使用正确的键名
   - 统一配置项名称，避免混淆

2. **修复前端API请求路径**
   - 修改前端登录页面和其他API请求，使用相对路径或动态路径
   - 确保请求能正确到达后端

3. **修复后端路由处理**
   - 确保直接访问API文件也能正确处理
   - 增强路由映射的灵活性

4. **完善数据库初始化**
   - 确保DatabaseInit.php能正确创建所有必要的表
   - 特别检查api_keys表的创建

5. **修复API密钥生成**
   - 确保api_keys表存在
   - 增强API密钥生成的错误处理

6. **修复登录功能**
   - 确保LoginFix.php能正确修复admin登录
   - 增强用户登录的错误处理

7. **修复文件路径引用**
   - 检查所有文件的相对路径引用
   - 确保文件能正确加载

8. **统一依赖加载方式**
   - 确保所有API请求通过backend/index.php处理
   - 避免直接加载vendor/autoload.php

## 修复顺序

1. 修复BaseModel.php中的数据库配置检查
2. 完善DatabaseInit.php
3. 修复API密钥生成
4. 修复登录功能
5. 修复前端API请求路径
6. 修复后端路由处理
7. 修复文件路径引用
8. 统一依赖加载方式

## 测试计划

1. 测试数据库连接
2. 测试admin登录
3. 测试用户登录
4. 测试API密钥生成
5. 测试用户列表获取
6. 测试添加用户功能
7. 测试系统健康检查

通过以上修复步骤，我将确保多用户接码系统的所有功能都能正常工作。