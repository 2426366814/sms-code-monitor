# 多用户版智能体动态验证码监控系统开发计划

## 1. 系统概述

基于单机版动态验证码监控系统，开发多用户版本，支持多用户管理、API功能扩展、管理员权限控制等。

### 1.1 核心功能

- **用户管理**：注册、登录、修改密码/用户名、角色管理
- **监控管理**：添加、删除、刷新监控项，批量操作
- **验证码管理**：历史验证码记录、一键复制、通知提示
- **API功能**：为每个用户提供独立的API接口
- **管理员功能**：用户管理、系统配置、数据统计

### 1.2 技术栈

- 后端：PHP 7.4+
- 数据库：MySQL 5.7+
- 前端：HTML5+CSS3+JavaScript (ES6+)
- 认证：JWT
- 架构：RESTful API

## 2. 系统架构

### 2.1 架构设计

```
┌───────────────────────────────────────────────────────────┐
│                       浏览器                            │
├───────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌───────────┐  │
│  │   用户认证UI    │  │   监控管理UI    │  │  验证码UI │  │
│  └─────────────────┘  └─────────────────┘  └───────────┘  │
│          │                     │                     │      │
│          └─────────────┬───────┘                     │      │
│                        ▼                             │      │
│  ┌───────────────────────────────────────────────┐    │      │
│  │              前端核心逻辑                     │    │      │
│  └───────────────────────────────────────────────┘    │      │
│                        │                              │      │
│                        ▼                              │      │
├───────────────────────────────────────────────────────────┤
│                      API网关层                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌───────────┐  │
│  │   JWT认证中间件   │  │   权限控制中间件  │  │   日志中间件│  │
│  └─────────────────┘  └─────────────────┘  └───────────┘  │
├───────────────────────────────────────────────────────────┤
│                      后端服务层                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌───────────┐  │
│  │   用户服务       │  │   监控服务       │  │  验证码服务│  │
│  └─────────────────┘  └─────────────────┘  └───────────┘  │
├───────────────────────────────────────────────────────────┤
│                      数据存储层                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌───────────┐  │
│  │   MySQL数据库   │  │   Redis缓存     │  │  日志文件  │  │
│  └─────────────────┘  └─────────────────┘  └───────────┘  │
└───────────────────────────────────────────────────────────┘
```

## 3. 数据库设计

### 3.1 核心表结构

#### 3.1.1 用户表 (users)

| 字段名       | 数据类型     | 约束条件               | 描述                 |
|------------|------------|----------------------|--------------------|
| id         | INT        | PRIMARY KEY AUTO_INCREMENT | 用户ID             |
| username   | VARCHAR(50)| NOT NULL UNIQUE      | 用户名               |
| email      | VARCHAR(100)| NOT NULL UNIQUE      | 邮箱                |
| password   | VARCHAR(255)| NOT NULL             | 密码哈希             |
| role       | ENUM       | DEFAULT 'user'       | 角色（admin/user）    |
| status     | ENUM       | DEFAULT 'active'     | 状态（active/inactive） |
| created_at | TIMESTAMP  | DEFAULT CURRENT_TIMESTAMP | 创建时间           |
| updated_at | TIMESTAMP  | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 3.1.2 监控项表 (monitors)

| 字段名           | 数据类型     | 约束条件               | 描述                 |
|----------------|------------|----------------------|--------------------|
| id             | INT        | PRIMARY KEY AUTO_INCREMENT | 监控ID             |
| user_id        | INT        | NOT NULL FOREIGN KEY | 用户ID              |
| phone          | VARCHAR(20)| NOT NULL             | 手机号               |
| url            | VARCHAR(255)| NOT NULL             | API URL            |
| status         | ENUM       | DEFAULT 'no-code'    | 状态（loading/success/no-code/error） |
| last_code      | TEXT       | DEFAULT NULL         | 原始响应             |
| last_extracted_code | VARCHAR(10)| DEFAULT NULL      | 提取的验证码         |
| code_timestamp | BIGINT     | DEFAULT NULL         | 验证码时间戳         |
| code_time_str  | VARCHAR(50)| DEFAULT NULL         | 验证码时间字符串       |
| last_update    | VARCHAR(50)| DEFAULT NULL         | 最后刷新时间         |
| last_update_timestamp | BIGINT | DEFAULT NULL      | 最后刷新时间戳         |
| message        | VARCHAR(255)| DEFAULT NULL         | 状态消息             |
| created_at     | TIMESTAMP  | DEFAULT CURRENT_TIMESTAMP | 创建时间           |
| updated_at     | TIMESTAMP  | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 3.1.3 验证码记录表 (codes)

| 字段名         | 数据类型     | 约束条件               | 描述                 |
|--------------|------------|----------------------|--------------------|
| id           | INT        | PRIMARY KEY AUTO_INCREMENT | 记录ID             |
| monitor_id   | INT        | NOT NULL FOREIGN KEY | 监控ID              |
| code         | VARCHAR(10)| NOT NULL             | 验证码               |
| original_text | TEXT       | NOT NULL             | 原始响应文本         |
| extracted_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 提取时间           |
| created_at   | TIMESTAMP  | DEFAULT CURRENT_TIMESTAMP | 创建时间           |

#### 3.1.4 API设置表 (api_settings)

| 字段名       | 数据类型     | 约束条件               | 描述                 |
|------------|------------|----------------------|--------------------|
| id         | INT        | PRIMARY KEY AUTO_INCREMENT | 设置ID             |
| user_id    | INT        | NOT NULL FOREIGN KEY | 用户ID              |
| api_key    | VARCHAR(64)| NOT NULL UNIQUE      | API密钥             |
| secret_key | VARCHAR(64)| NOT NULL             | 密钥                |
| rate_limit | INT        | DEFAULT 1000         | 每分钟请求限制         |
| status     | ENUM       | DEFAULT 'active'     | 状态（active/inactive） |
| created_at | TIMESTAMP  | DEFAULT CURRENT_TIMESTAMP | 创建时间           |
| updated_at | TIMESTAMP  | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

## 4. API设计

### 4.1 认证API

| 路径 | 方法 | 功能 | 权限 |
|------|------|------|------|
| /api/auth/register | POST | 用户注册 | 匿名 |
| /api/auth/login | POST | 用户登录 | 匿名 |
| /api/auth/refresh | POST | 刷新令牌 | 已认证 |
| /api/auth/logout | POST | 用户登出 | 已认证 |
| /api/auth/password | PUT | 修改密码 | 已认证 |
| /api/auth/profile | GET | 获取用户信息 | 已认证 |
| /api/auth/profile | PUT | 更新用户信息 | 已认证 |

### 4.2 监控项API

| 路径 | 方法 | 功能 | 权限 |
|------|------|------|------|
| /api/monitors | GET | 获取监控列表 | 已认证 |
| /api/monitors | POST | 添加监控项 | 已认证 |
| /api/monitors/:id | GET | 获取监控项详情 | 已认证 |
| /api/monitors/:id | PUT | 更新监控项 | 已认证 |
| /api/monitors/:id | DELETE | 删除监控项 | 已认证 |
| /api/monitors/batch | POST | 批量添加监控项 | 已认证 |
| /api/monitors/refresh-all | POST | 刷新所有监控项 | 已认证 |
| /api/monitors/:id/refresh | POST | 刷新单个监控项 | 已认证 |

### 4.3 验证码API

| 路径 | 方法 | 功能 | 权限 |
|------|------|------|------|
| /api/codes | GET | 获取验证码历史 | 已认证 |
| /api/codes/:id | GET | 获取验证码详情 | 已认证 |

### 4.4 用户API（管理员）

| 路径 | 方法 | 功能 | 权限 |
|------|------|------|------|
| /api/admin/users | GET | 获取用户列表 | 管理员 |
| /api/admin/users/:id | GET | 获取用户详情 | 管理员 |
| /api/admin/users/:id | PUT | 更新用户信息 | 管理员 |
| /api/admin/users/:id | DELETE | 删除用户 | 管理员 |
| /api/admin/users/:id/role | PUT | 修改用户角色 | 管理员 |

## 5. 前端设计

### 5.1 页面结构

1. **登录页**：用户登录和注册
2. **监控面板**：监控项列表、刷新控制、历史验证码
3. **添加监控项页**：单个添加和批量导入
4. **用户设置页**：修改密码、用户名、API设置
5. **管理员面板**：用户管理、系统配置

### 5.2 核心功能

- 响应式设计，适配不同屏幕尺寸
- 实时刷新监控项
- 历史验证码展示
- 一键复制功能
- 通知提示
- 批量操作

## 6. 开发步骤

### 6.1 准备工作

1. 删除原有代码文件
2. 创建项目目录结构
3. 配置开发环境
4. 设计数据库schema

### 6.2 后端开发

1. 搭建PHP后端框架
2. 实现数据库连接和ORM
3. 开发用户认证模块
4. 开发监控项管理模块
5. 开发验证码管理模块
6. 开发API设置模块
7. 开发管理员功能
8. 编写API文档

### 6.3 前端开发

1. 设计页面布局和UI
2. 实现用户认证功能
3. 实现监控项管理功能
4. 实现验证码展示功能
5. 实现用户设置功能
6. 实现管理员功能
7. 优化用户体验

### 6.4 测试与部署

1. 单元测试
2. 集成测试
3. 功能测试
4. 性能测试
5. 安全测试
6. 部署到生产环境

## 7. 安全性考虑

1. **用户认证**：使用JWT认证，设置合理的过期时间
2. **密码安全**：使用bcrypt哈希存储密码
3. **权限控制**：基于角色的访问控制，最小权限原则
4. **数据安全**：HTTPS加密传输，SQL注入防护，XSS防护
5. **API安全**：API限流，请求验证，防止恶意请求
6. **日志记录**：详细的操作日志，便于审计和调试

## 8. 性能优化

1. **数据库优化**：合理索引，查询优化
2. **缓存策略**：Redis缓存热点数据
3. **异步处理**：异步刷新监控项，减少阻塞
4. **前端优化**：资源压缩，懒加载，减少HTTP请求
5. **代码优化**：高效算法，减少不必要的计算

## 9. 文档完善

1. 开发文档
2. 部署文档
3. 使用手册
4. API文档
5. 数据库设计文档

## 10. 预期成果

1. 完整的多用户版动态验证码监控系统
2. 支持多用户管理和API功能
3. 完善的管理员功能
4. 详细的开发和使用文档
5. 安全可靠的系统架构
6. 良好的用户体验

## 11. 开发周期

预计开发周期为2-3周，包括设计、开发、测试和文档编写。

## 12. 风险评估

1. **技术风险**：PHP+MySQL环境配置，JWT集成
2. **安全风险**：用户认证，API安全
3. **性能风险**：大量监控项同时刷新
4. **兼容性风险**：不同浏览器和设备适配

## 13. 后续扩展

1. 支持更多通知方式（邮件、短信、Webhook）
2. 智能验证码识别
3. 数据分析和报表
4. 移动端支持
5. 第三方API集成