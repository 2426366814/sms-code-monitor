## 问题分析

登录请求返回500错误，响应信息显示"数据库连接失败"。通过代码审查发现以下问题：

1. **配置不一致**：`config.php`中数据库密码默认值为空字符串，而`database.php`中默认密码为`'ck123456@'`
2. **环境变量加载**：需要确保`.env`文件中的数据库配置正确加载
3. **数据库连接参数**：需要验证数据库主机、端口、用户名、密码等参数是否正确
4. **数据库服务状态**：需要检查数据库服务是否正常运行

## 修复方案

### 1. 统一数据库配置

修改`config.php`中的数据库配置，确保默认密码与`.env`文件一致：

```php
// 将数据库密码默认值从空字符串改为与.env一致
'password' => EnvUtil::get('DB_PASSWORD', 'ck123456@'),
```

### 2. 修复数据库配置文件引用

检查`index.php`中是否正确引用了配置文件，确保环境变量加载顺序正确：

```php
// 确保先加载环境变量，再加载数据库配置
require_once __DIR__ . '/utils/EnvUtil.php';
EnvUtil::load(__DIR__ . '/../.env');
$config = require __DIR__ . '/config/config.php';
```

### 3. 增强错误处理和日志记录

在数据库连接失败时提供更详细的错误信息，便于调试：

```php
// 在BaseModel或数据库连接类中添加更详细的错误日志
try {
    $pdo = new PDO($dsn, $username, $password, $options);
} catch (PDOException $e) {
    error_log('数据库连接失败: ' . $e->getMessage() . ', DSN: ' . $dsn . ', Username: ' . $username);
    throw $e;
}
```

### 4. 验证环境变量加载

确保`.env`文件存在且权限正确，EnvUtil能够正常加载环境变量：

```php
// 在EnvUtil中添加加载结果日志
$env = EnvUtil::load(__DIR__ . '/../../.env');
error_log('环境变量加载结果: ' . json_encode($env));
```

### 5. 添加数据库连接测试

在登录流程中添加数据库连接测试，提前发现连接问题：

```php
// 在UserService的login方法中添加数据库连接测试
$pdo = $this->userModel->getConnection();
if (!$pdo) {
    error_log('数据库连接获取失败');
    throw new Exception('数据库连接失败');
}
```

## 预期效果

* 修复数据库连接失败问题，使登录功能正常工作

* 统一数据库配置，避免配置不一致导致的问题

* 增强错误日志，便于后续调试和问题定位

* 确保环境变量正确加载，配置参数一致

## 测试步骤

1. 修改配置文件后，重新启动Web服务器
2. 使用登录页面或调试工具进行登录测试
3. 检查日志文件，确认数据库连接是否成功
4. 验证登录功能是否正常工作

