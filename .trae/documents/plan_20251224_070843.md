# 管理员面板问题修复计划

## 问题分析
1. **添加用户功能问题**：已修复权限检查代码的缩进问题，现在管理员可以成功添加用户
2. **退出按钮问题**：退出按钮位于右上角用户头像的下拉菜单中，用户可能没有注意到，需要添加更明显的退出选项
3. **API功能问题**：已确保API密钥生成功能正常，api_keys表存在检查和自动创建逻辑完整

## 修复方案

### 1. 在侧边栏添加退出按钮
- **文件**：所有管理员面板HTML文件（users.html, system.html, dashboard.html, monitors.html, codes.html）
- **位置**：侧边栏菜单底部
- **实现**：添加一个新的菜单项，直接调用logout()函数
- **代码变更**：
  ```html
  <li class="nav-item">
      <a class="nav-link" href="#" onclick="logout()">
          <span class="nav-icon">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"></path>
                  <path d="M7 12h14l-3 -3m0 6l3 -3"></path>
              </svg>
          </span>
          <span class="nav-text">退出登录</span>
      </a>
  </li>
  ```

### 2. 确保退出功能正常工作
- **文件**：所有管理员面板HTML文件的JavaScript部分
- **检查**：确保logout()函数在所有页面都正确实现
- **状态**：已实现，清除localStorage并跳转到登录页面

### 3. 验证添加用户功能
- **文件**：backend/api/admin/index.php
- **检查**：确保权限检查代码缩进正确，使用正确的权限名称
- **状态**：已修复，使用manage_users权限进行检查

### 4. 验证API功能
- **文件**：backend/services/ApiService.php 和 backend/models/ApiKeyModel.php
- **检查**：确保api_keys表存在检查和自动创建逻辑完整
- **状态**：已验证，包含完整的表存在检查和自动创建逻辑

## 修复步骤
1. 在所有管理员面板页面的侧边栏添加退出按钮
2. 测试添加用户功能，确保权限检查正常
3. 测试API密钥生成功能，确保API功能正常

## 预期结果
- 管理员可以成功添加用户
- 退出按钮在侧边栏明显可见，功能正常
- API密钥生成功能正常，API端点可访问