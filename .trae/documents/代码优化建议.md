# 获取监控手机号码API设计

## 1. 现有API分析

目前系统已经提供了一个GET请求的API端点 `GET /api/monitor.php`，该端点返回当前用户的所有监控项，包括手机号码、URL、状态等完整信息。

**现有API响应格式**：
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "user_id": 1,
      "phone": "+13199898616",
      "url": "https://api.example.com/sms",
      "status": "success",
      "last_code": "原始响应",
      "last_extracted_code": "123456",
      "code_timestamp": 1734180000000,
      "code_time_str": "2025-12-14 10:00:00",
      "last_update": "2025-12-14 10:00:00",
      "last_update_timestamp": 1734180000000,
      "message": "获取成功",
      "created_at": "2025-12-14 09:00:00",
      "updated_at": "2025-12-14 10:00:00"
    }
  ],
  "message": "获取成功",
  "code": 200
}
```

## 2. 规范API设计方案

### 2.1 方案1：扩展现有API

**API端点**：`GET /api/monitor.php`

**新增参数**：
- `fields`: 可选，指定返回的字段，例如 `fields=phone` 只返回手机号码
- `format`: 可选，指定返回格式，例如 `format=simple` 返回简化格式

**示例请求**：
```
GET /api/monitor.php?fields=phone
```

**示例响应**：
```json
{
  "success": true,
  "data": [
    { "phone": "+13199898616" },
    { "phone": "+13800138000" }
  ],
  "message": "获取成功",
  "code": 200
}
```

### 2.2 方案2：新增专门的API端点

**API端点**：`GET /api/phones`

**请求方法**：GET

**认证方式**：JWT认证，需要在请求头中携带 `Authorization: Bearer <token>`

**请求参数**：
- `page`: 可选，页码，默认1
- `pageSize`: 可选，每页数量，默认10
- `sortBy`: 可选，排序字段，默认created_at
- `order`: 可选，排序顺序，默认desc

**响应格式**：
```json
{
  "success": true,
  "data": {
    "phones": [
      "+13199898616",
      "+13800138000",
      "+85295765260"
    ],
    "total": 3,
    "page": 1,
    "pageSize": 10,
    "totalPages": 1
  },
  "message": "获取成功",
  "code": 200
}
```

### 2.3 方案3：新增带筛选功能的API

**API端点**：`GET /api/monitor/phones`

**请求方法**：GET

**请求参数**：
- `search`: 可选，搜索关键词
- `status`: 可选，按状态筛选（success, no-code, error）
- `startDate`: 可选，开始日期
- `endDate`: 可选，结束日期

**响应格式**：
```json
{
  "success": true,
  "data": {
    "phones": [
      {
        "phone": "+13199898616",
        "status": "success",
        "createdAt": "2025-12-14 09:00:00"
      }
    ],
    "total": 1
  },
  "message": "获取成功",
  "code": 200
}
```

## 3. API设计规范

### 3.1 认证要求
- 所有API请求必须通过JWT认证
- 请求头中必须包含 `Authorization: Bearer <token>`
- 未认证或认证失败返回401状态码

### 3.2 响应规范
- 所有API返回统一的JSON格式
- 包含 `success`, `message`, `code`, `data` 字段
- 错误响应包含明确的错误代码和消息

### 3.3 安全要求
- 只能访问当前用户的监控手机号码
- 防止SQL注入和XSS攻击
- 限制请求频率，防止恶意请求

### 3.4 性能要求
- 支持分页，默认每页10条
- 优化数据库查询，添加必要的索引
- 响应时间不超过500ms

## 4. 实现建议

1. **基于现有API扩展**：
   - 修改 `monitor.php`，添加 `fields` 参数支持
   - 根据字段参数返回相应的数据
   - 保持向后兼容

2. **新增专门的API端点**：
   - 创建新的 `phones.php` 文件
   - 实现专门的手机号码查询逻辑
   - 支持更灵活的筛选和排序

3. **考虑用户体验**：
   - 提供清晰的API文档
   - 支持多种返回格式
   - 添加详细的错误信息

## 5. 总结

根据用户需求，可以选择扩展现有API或新增专门的API端点来获取当前用户的监控手机号码。建议采用方案2，新增专门的API端点 `GET /api/phones`，这样可以提供更简洁的响应格式和更灵活的查询功能，同时保持现有API的稳定性。

这个设计方案遵循了RESTful API设计原则，提供了清晰的请求和响应格式，同时考虑了安全性、性能和用户体验等方面。