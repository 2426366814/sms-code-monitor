# 多用户智能体动态验证码监控系统开发计划

## 1. 系统概述

基于当前单机版本，开发一个支持多用户的动态验证码监控系统，包括用户认证、监控管理、验证码获取、API服务等功能。系统采用PHP+MySQL后端，支持JWT认证和RESTful API设计。

## 2. 数据库设计

### 2.1 用户表 (users)
- id: INT (主键，自增)
- username: VARCHAR(50) (唯一，用户名)
- email: VARCHAR(100) (唯一，邮箱)
- password: VARCHAR(255) (密码哈希)
- role: ENUM('admin', 'user') (角色)
- status: ENUM('active', 'inactive') (状态)
- created_at: TIMESTAMP (创建时间)
- updated_at: TIMESTAMP (更新时间)

### 2.2 监控表 (monitors)
- id: INT (主键，自增)
- user_id: INT (外键，关联用户表)
- name: VARCHAR(100) (监控名称)
- phone: VARCHAR(20) (手机号)
- url: VARCHAR(255) (监控URL)
- selector: VARCHAR(255) (验证码选择器)
- check_interval: INT (检查间隔，秒)
- timeout: INT (超时时间，秒)
- status: ENUM('active', 'paused', 'error') (状态)
- last_code: TEXT (最后获取的原始代码)
- last_extracted_code: VARCHAR(10) (提取的验证码)
- code_timestamp: BIGINT (验证码时间戳)
- code_time_str: VARCHAR(50) (验证码时间字符串)
- last_update: VARCHAR(50) (最后更新时间)
- last_update_timestamp: BIGINT (最后更新时间戳)
- message: VARCHAR(255) (状态信息)
- created_at: TIMESTAMP (创建时间)
- updated_at: TIMESTAMP (更新时间)

### 2.3 验证码记录表 (codes)
- id: INT (主键，自增)
- monitor_id: INT (外键，关联监控表)
- code: VARCHAR(10) (验证码)
- original_text: TEXT (原始文本)
- extracted_time: TIMESTAMP (提取时间)
- created_at: TIMESTAMP (创建时间)

### 2.4 API设置表 (api_settings)
- id: INT (主键，自增)
- user_id: INT (外键，关联用户表)
- api_key: VARCHAR(64) (API密钥)
- secret_key: VARCHAR(64) (密钥)
- rate_limit: INT (请求限制)
- status: ENUM('active', 'inactive') (状态)
- created_at: TIMESTAMP (创建时间)
- updated_at: TIMESTAMP (更新时间)

## 3. 后端API开发

### 3.1 用户认证API
- POST /api/auth/register (用户注册)
- POST /api/auth/login (用户登录)
- POST /api/auth/refresh (刷新令牌)
- POST /api/auth/logout (用户登出)
- PUT /api/auth/change-password (修改密码)
- PUT /api/auth/change-username (修改用户名)
- GET /api/auth/profile (获取用户信息)

### 3.2 监控管理API
- GET /api/monitors (获取监控列表)
- POST /api/monitors (创建监控)
- GET /api/monitors/{id} (获取单个监控)
- PUT /api/monitors/{id} (更新监控)
- DELETE /api/monitors/{id} (删除监控)
- POST /api/monitors/batch (批量导入监控)
- POST /api/monitors/refresh-all (刷新所有监控)
- POST /api/monitors/{id}/refresh (刷新单个监控)

### 3.3 验证码API
- GET /api/codes (获取验证码历史)

### 3.4 管理员API
- GET /api/admin/users (获取用户列表)
- POST /api/admin/users (创建用户)
- GET /api/admin/users/{id} (获取单个用户)
- PUT /api/admin/users/{id} (更新用户)
- DELETE /api/admin/users/{id} (删除用户)

### 3.5 API设置API
- GET /api/api-settings (获取API设置)
- PUT /api/api-settings (更新API设置)
- POST /api/api-settings/generate (生成新API密钥)

## 4. 前端开发

### 4.1 登录/注册页面
- 登录表单
- 注册表单
- 密码找回功能

### 4.2 用户面板
- 个人资料管理
- 修改用户名和密码
- 监控管理
- 验证码历史
- API设置

### 4.3 管理员面板
- 用户管理（添加、编辑、删除用户）
- 系统统计
- 日志管理

## 5. 核心功能实现

### 5.1 用户认证
- JWT令牌生成与验证
- 密码哈希与验证
- 令牌刷新机制

### 5.2 监控功能
- 定时刷新监控项
- 验证码提取与解析
- 状态更新与通知

### 5.3 API服务
- API密钥认证
- 请求限流
- 数据格式统一

### 5.4 批量处理
- 批量导入监控项
- 批量刷新监控

## 6. 技术栈

- **后端**: PHP 7.4+, MySQL 5.7+
- **认证**: JWT (JSON Web Token)
- **数据库**: PDO
- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **API**: RESTful
- **CORS**: 支持跨域请求

## 7. 部署方案

### 7.1 宝塔面板部署
- 环境配置（PHP、MySQL）
- 数据库创建与导入
- 代码上传与配置
- 域名绑定与SSL配置
- 定时任务设置

### 7.2 手动部署
- LAMP/WAMP环境搭建
- 数据库配置
- 虚拟主机配置
- 权限设置

## 8. 开发流程

1. 数据库设计与创建
2. 后端核心功能开发
3. API接口开发
4. 前端页面开发
5. 功能测试与优化
6. 文档编写
7. 部署与上线

## 9. 预期成果

- 完整的多用户动态验证码监控系统
- 详细的开发文档
- 宝塔面板部署指南
- 打包好的应用程序

## 10. 安全性考虑

- 密码加密存储
- JWT令牌安全
- API请求验证
- 输入数据过滤
- SQL注入防护
- XSS攻击防护

## 11. 扩展性设计

- 模块化代码结构
- 支持插件扩展
- 支持多语言
- 支持第三方通知（邮件、短信）

## 12. 性能优化

- 数据库索引优化
- 缓存机制
- 异步处理
- 代码优化

# 开发文档结构

1. 系统概述
2. 技术栈
3. 数据库设计
4. API文档
5. 前端功能说明
6. 后端功能说明
7. 部署指南
8. 使用说明
9. 安全性说明
10. 故障排除
11. 版本更新记录

# 宝塔面板部署方法

1. 环境准备
2. 数据库创建
3. 代码上传
4. 配置文件修改
5. 虚拟主机设置
6. SSL配置
7. 定时任务设置
8. 测试与验证

# 打包说明

1. 代码压缩
2. 配置文件处理
3. 部署脚本生成
4. 版本标识
5. 文档打包