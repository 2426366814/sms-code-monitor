# 多用户动态验证码监控系统部署指南

## 项目概述

多用户动态验证码监控系统是一个用于实时监控多个手机号验证码的网页应用，支持多用户管理、自动刷新、一键复制、导出数据等功能。

**访问地址**: http://192.168.7.178:8080

## 部署包信息

- **文件名**: verify-code-monitor.zip
- **大小**: 约 50KB
- **包含内容**:
  - 前端页面 (index.html, login.html, register.html)
  - 后端API (backend/api/)
  - 配置文件 (backend/config/)
  - 数据库脚本 (backend/database/)
  - 模型类 (backend/models/)
  - 工具类 (backend/utils/)

## 部署步骤

### 1. 环境要求

- **操作系统**: Linux (CentOS 7/8, Ubuntu 20.04+)
- **Web服务器**: Nginx 或 Apache
- **PHP版本**: 7.4+
- **数据库**: MySQL 8.0+
- **内存**: 至少 512MB
- **磁盘空间**: 至少 1GB

### 2. 宝塔面板部署

#### 2.1 创建网站

1. 登录宝塔面板 (http://192.168.7.178:777)
2. 点击「网站」→「添加站点」
3. 填写以下信息:
   - 域名: `192.168.7.178:8080` (或自定义域名)
   - 根目录: `/www/wwwroot/verify-code-monitor.local`
   - PHP版本: 7.4
4. 点击「提交」

#### 2.2 上传项目文件

1. 点击「文件」进入文件管理器
2. 进入 `/www/wwwroot/verify-code-monitor.local` 目录
3. 点击「上传」按钮
4. 选择 `verify-code-monitor.zip` 文件上传
5. 上传完成后，右键点击压缩包选择「解压」
6. 确保解压后的文件结构正确:
   ```
   verify-code-monitor.local/
   ├── index.html
   ├── login.html
   ├── register.html
   └── backend/
       ├── api/
       │   ├── admin/
       │   ├── auth/
       │   ├── codes/
       │   ├── health/
       │   └── monitors/
       ├── config/
       ├── database/
       ├── models/
       └── utils/
   ```

#### 2.3 配置数据库

1. 点击「数据库」→「添加数据库」
2. 填写以下信息:
   - 数据库名: `jm`
   - 用户名: `jm`
   - 密码: `ck123456@`
   - 字符集: `utf8mb4`
3. 点击「提交」
4. 点击「导入」按钮
5. 选择 `backend/database/database.sql` 文件导入

#### 2.4 配置网站

1. 点击「网站」→ 找到刚才创建的网站 →「设置」
2. 进入「伪静态」选项卡，选择 `thinkphp` 或添加以下规则:
   ```nginx
   location / {
       if (!-e $request_filename) {
           rewrite ^(.*)$ /index.php?s=$1 last;
       }
   }
   ```
3. 进入「运行目录」选项卡，确保运行目录为 `/www/wwwroot/verify-code-monitor.local`
4. 点击「保存」

### 3. 手动部署 (无宝塔面板)

#### 3.1 上传文件

```bash
# 使用SCP上传文件
scp verify-code-monitor.zip root@192.168.7.178:/www/wwwroot/

# 登录服务器解压
ssh root@192.168.7.178
cd /www/wwwroot
unzip verify-code-monitor.zip -d verify-code-monitor.local
```

#### 3.2 配置Nginx

```nginx
server {
    listen 8080;
    server_name 192.168.7.178;
    root /www/wwwroot/verify-code-monitor.local;
    index index.html index.php;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /backend/ {
        try_files $uri $uri/ /backend/index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

#### 3.3 配置MySQL

```bash
# 登录MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE IF NOT EXISTS jm CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 创建用户
CREATE USER 'jm'@'localhost' IDENTIFIED BY 'ck123456@';

# 授权
GRANT ALL PRIVILEGES ON jm.* TO 'jm'@'localhost';
FLUSH PRIVILEGES;

# 导入数据
mysql -u jm -p jm < /www/wwwroot/verify-code-monitor.local/backend/database/database.sql
```

### 4. 验证部署

#### 4.1 访问网站

打开浏览器访问: http://192.168.7.178:8080

#### 4.2 测试登录

- **用户名**: admin
- **密码**: admin

#### 4.3 健康检测

访问: http://192.168.7.178:8080/backend/api/health/index.php

应该返回JSON格式的健康检测结果。

### 5. 故障排除

#### 5.1 403 错误

- 检查文件权限: `chmod -R 755 /www/wwwroot/verify-code-monitor.local`
- 检查目录所有者: `chown -R www:www /www/wwwroot/verify-code-monitor.local`

#### 5.2 404 错误

- 检查Nginx配置是否正确
- 检查伪静态规则是否正确
- 检查文件是否上传到正确位置

#### 5.3 500 错误

- 检查PHP错误日志: `/var/log/php-fpm/error.log`
- 检查Nginx错误日志: `/var/log/nginx/error.log`
- 检查数据库连接配置是否正确

#### 5.4 数据库连接失败

- 检查数据库服务是否运行: `systemctl status mysql`
- 检查数据库配置: `backend/config/config.php`
- 检查数据库用户权限是否正确

### 6. 安全建议

1. **修改默认密码**: 首次登录后请立即修改管理员密码
2. **启用HTTPS**: 生产环境建议启用SSL证书
3. **防火墙配置**: 只开放必要的端口 (80, 443, 8080)
4. **定期备份**: 设置定期备份数据库和项目文件
5. **更新系统**: 定期更新系统和软件包

### 7. 维护指南

#### 7.1 备份

```bash
# 备份数据库
mysqldump -u jm -p jm > backup_$(date +%Y%m%d).sql

# 备份项目文件
tar -czvf backup_$(date +%Y%m%d).tar.gz /www/wwwroot/verify-code-monitor.local
```

#### 7.2 更新

1. 备份现有数据
2. 下载新版本部署包
3. 解压覆盖现有文件
4. 检查配置文件是否需要更新
5. 测试功能是否正常

## 联系方式

如有问题，请联系系统管理员。
